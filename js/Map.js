var __MAP__ = 
['................................................................................................................................................................................................',
'................................................................................................................................................................................................',
'................................................................................................................................................................................................',
'................................................................................................................................................................................................',
'........................................................................................................................................................................................GGGG....',
'........................................................................................................................................................................................GGGG....',
'..................................................................................................................................................................................GGGGGGGGGG....',
'.................................................................................................................................................................................GGGGGGGGGGGG...',
'....................AA..................................AAAAAAAAAA..............................................................................................................GGGGGGGGGGGGGG..',
'...................AAAA....................AAAAA.......AAAAAAAAAAAA.............................................................................................................GGGGGGGGGGGGGG..',
'................AAAAAAAAAAAA..........AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA....................................................................................................GGGGGGGG..GG..',
'...............AAAAAAAAAAAAAA........AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA..................................................................................................GGGGGGGGG..GG..',
'..............AAAAAAAAAAAAAAAA.AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA............................................................................................CCCCCCCCC............GGGGGGGGGG...GGGGG',
'..............AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA............................................................................................CCCCCCCCCCC..........GGGGGGGGGGG..GGGGGG',
'..............AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.....2.................................................................CCCCC........CCCC........CCCCCCCCCCCCCCC........GGGGGGGGGG......GGG.',
'.............AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA......................................................................CCCCCCCC......CCCCCC......CCCCCCCCCCCCCCCC........GGGGGGGGGG.......GG.',
'............AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...................................................................CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC.........GGGGGG..........G.',
'...........AAAAAAAAAAAAAAAAAAAAAAAAAAA..AAAAAA.....................................................................CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC.........GGGGGG............',
'..........AAAAAAAAAAAAAAAAAAAAAAAAA.....................................................................................CCCCCCCCCCCCCCCCCCCCCCCCCCCCCC......CCCCCCCC...........GGGGGGG..........',
'..........AAAAAAAAAAAAAAAAAAAAAAAA.........................2..............................................................CCCCCCCCCCCCCCCCCCCCCCCCCCCC......CCCCCCCC............GGGGGG..........',
'..........AAAAAAAAAAAAAAAAAAAA....................BBBBBBBBBBBB....................................................................CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC.........GGGGGGGGG........',
'............AAAAAAAAAAAAAAAAAA..................BBBBBBBBBBBBBB....................................................................CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC..........GGGGGGGGG.......',
'..............AAAAAAAAAAAAAA1.................BBBBBBBBBBBBBBBB.......................................................................3CCCCCCCCCC....CCCCCCCCCCCCCCCCCC.............GGGGGGG......',
'.............AAAAAAAAAAAAAAA.................BBBBBBBBBBBBBBBBBB.......................................................................CCCCCCCCCC....CCCCCCCCCCCCCCCCCC..............GGGGGG......',
'............AAAAAAAAAAAAAAAA................BBBBBBBBBB....BBBBBB3.....................................................................CCCCCCCC......CCCCCCCCCCCC................GGGGGGGGG.......',
'............AAAAAAAAAAAAAAAA...............BBBBBBBBBBB....BBBBBB......................................................................CCCCCCCC......CCCCCCCCCCCC................GGGGGGGG........',
'............AAAAAAA.AAAA.AAA..............BBBBBBBBBBBBBBBBBBBBB...................................................................CCCCCCCCCCCCCCCCCCCCCCCCCC.....................GGGGGG.........',
'.............AAAAA..AAAA..AA.............1BBBBBBBBBBBBBBBBBBBB....................................................................CCCCCCCCCCCCCCCCCCCCCCCCCC......................GGGG..........',
'....................AAAA..................BBBBBBBBBBBBBBBBBB........................................................................CCCCCCCCCCCCCCCCCCCCCCCC.......................G............',
'....................AAAA..................BBBBBBBBBBBBBBBB..........................................................................CCCCCCCCCCCCCCCCCCCCCCCC....................................',
'....................AAA...................BBBBBBBBBBBBBB..............................................................................CCCCCCCCCC..CCCCCCCCCCCC..................................',
'....................AA....................BBBBBBBBBBBB4...............................................................................CCCCCCCCCC..CCCCCCCCCCCC..................................',
'....................7.......................BBBBBBBB..................................................................................5...........CCCC..CCCCCC..................................',
'..................................................................................................................................................CCCC..CCCCCC..................................',
'....................................................................................................................................................CCCCCCCC....................................',
'....................................................................................................................................................CCCCCCCC....................................',
'................................................................................................................................................................................................',
'................................................................................................................................................................................................',
'................................................................................................................................................................................................',
'.....................................................................................................................................5..........................................................',
'............................................................................................................................DDDDDDDDDD..........................................................',
'..........................................................................................................................DDDDDDDDDDDDDD........................................................',
'....................................................................................................................DDDDDDDDDDDDDDDDDDDDDDD.....................................................',
'..............7.....................................................................................................DDDDDDDDDDDDDDDDDDDDDDDD....................................................',
'..............EE................................................................................................DDDDDDDDDDDDDDDDDDDDDDDDDDDDDD..................................................',
'.............EEE................................................................................................DDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDD................................................',
'............EEEEEEEEEE....................................................................................DDDDDDDD..DDDDDD..DDDDDDDDDDDDDDDDDDDDDD..............................................',
'...........EEEEEEEEEEE....................................................................................DDDDDDDD..DDDDDD..DDDDDDDDDDDDDDDDDDDDDD..............................................',
'..........EEEEEEEE............................................................................DDDDDDDDDDDDDDDDDDDDDDDDDD....DDDDDDDDDDDDDDDDDDDDDDDD............................................',
'..........EEEEEEEEE..........................................................4................DDDDDDDDDDDDDDDDDDDDDDDDDD.....DDDDDDDDDDDDDDDDDDDDDDD............................................',
'..............EEEEEE........................................................DDDD........DDDDDDDD....DDDDDDDDDDDDDDDDDD........DDDDDDDDDDDDDDDDDDDDDDDD..........................................',
'..............EEEEE.........................................................DDDD........DDDDDDDD........DDDDDDDDDDDDDD........DDDDDDDDDDDDDDDDDDDDDDDD..........................................',
'............EEEEEEEE........................................................DDDDDD......DDDDDDDDDDDDDD..DDDDDDDDDDDDDD.......DDDDDDDDDDDDDDDDDDDDDDDDD..........................................',
'............EEEEEEEE........................................................DDDDDD......DDDDDDDDDDDDDD..DDDDDDDDDDDDDD......DDDDDDDDDDDDDDDDDDDDDDDDDD..........................................',
'...............EEEE.........................................................DDDDDDDD..DDDDDDDDD.........DDDDDDDDDDDDDDDDDDDDDDDD........DDDDDDDDDDDD............................................',
'................EEEE........................................................DDDDDDDD..DDDDDDDD...DDDDDDDDDDDDDDDDDDDDDDDDDDDDD..........DDDDDDDDDDDD............................................',
'................EEEE........................................................DDDDDDDDDDDDDDDDD..DDDDDDDDDDDDDDDDDDDDD..............................6.............................................',
'................EEEE........................................................DDDDDDDDDDDDDDDD..DDDDDDDDDDDDDDDDDDDDDD............................................................................',
'..............EEEE...........................................................DDDDDDDDDDDDD...DDDDDDDDDDDDDDDDDDD................................................................................',
'............EEEEEE............................................................DDDDDDDDDDDD......DDDDDDDDDDDDDDDD................................................................................',
'..........EEEEEEEE..........................................................DDDDDDDDDDDDDDDDDDD.DDDDDDDDDDDD....................................................................................',
'..........EEEEEEEE..........................................................DDDDDDDDDDDDDDDDDDD.DDDDDDDDDDDD....................................................................................',
'..........EEEEEEEE..........................................................DDDDDDDDDDDDDDDDDDD.DDDDDDDD........................................................................................',
'............EEEEEE..........................................................DDDDDDDDDDDDDDDDDDDDDDDDDDDD.................................................................FFFF...................',
'..........EEEEEE..........................................................DDDDDDDDDDDD..DDDDDDDDDD....................................................................FFFFFF....................',
'..........EEEEEE.....E....................................................DDDDDDDDDDDD..DDDDDDDD.....................................................................6FFFFFFF...................',
'...........EEEEE....EEEE....................................................DDDDDDDD..............................................................................FFFFFFFFFFFFFF................',
'..........EEEEEE....EEEEE...................................................DDDDDDDD..............................................................................FFFFFFFFFFFFFFF...............',
'..........EEEEEEEEEEEEEEEE..................................................DDDDDD........................................................................FFFFFFFFFFFFFFFFFFFFFFFFFF............',
'..........EEEEEEEEEEEEEE....................................................DDDDDD....................................................................FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF...........',
'..........EEEEEEEEEEEEEEEE..................................................DD............................................................FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF..........',
'.........EEEEEEEEEEEEEEEEE..................................................DD.........................................................FFFFFFFFFFFFFFFFFFFFFFFFF..FFFFFFFFFFFFFFFFFFFF..........',
'........EEEEEEEEEEEEEEEEEEEE8...............................................DD......................................................FFFFFFFFFFFFFFFFFFFFFFFFFFF......FFFFFFFFFFFFFFFFFFF........',
'........EEEEEEEEEEEEEEEEEEEE...............................................8DD.....................................................FFFFFFFFFFFFFFFFFFFFFFFFFFF........FFFFFFFFFFFFFFFFFF........',
'........EEEEEEEEEEEEEEEEEEEE......................................................................................................FFFFFFFFFFFF...FFFFFFFFFF......FFFFFFF....FFFFFFFFFFFF........',
'........EEEEEEEEEEEEEEEEEEEE......................................................................................................FFFFFFFFFFFF....FFFFFFFF.....FFFFFFFFFF...FFFFFFFFFFFF........',
'...........EEEEEEEE....EEEEEEE............................................................................................................FFFFF...FFFFFFFFFFFFFFFFFFFFFFFFFFFF..FFFFFFFF........',
'............EEEEEE......EEEEEE............................................................................................................FFFFFF.FFFFFFFFFFFFFFFFFFFFFFFFFFFFF....FFFFFF........',
'.........................EEEEEEEEE........................................................................................................FF.FFFFFFFFFFF....FFFFFFFFFFFFFFFFFFF...FFFFFF........',
'..........................EEEEEEEE........................................................................................................FF.FFFFFFFFFFF....FFFFFFFFFFFFFFFFFF.F..FFFFFF........',
'............................EEEEEE........................................................................................................FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF..........',
'............................EEEEEEE.......................................................................................................FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF...........',
'...........................EEEEEEEE.....................................................................................................FFFFFFFFFFFFFFFFFFFF..........FFFFFFFFFF................',
'...........................EEEEEEE.....................................................................................................FFFFFFFFFFFFFFFFFFFFF...........FFFFFFFF.................',
'............................EEEEEE..EE..............................................................................................FFFFFFFFFFFFFFFF..FFFFFFFF..................................',
'...........................EEEEEEE..EE............................................................................................FFFFFFFFFFFFFFFFFFF...FFFFFFF.................................',
'............................EEEEEEEEEE..EE........................................................................FFFFFFFFFFFFFFFFFFFFFFFFFFFFF...FFFFFFFFFFFF..................................',
'............................EEEEEEEEEE..EE.......................................................................FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF..FFFFFFFFFFFF..................................',
'...............................EEEEEEEEEEEEE..EEEEEE..........................................................FFFFFF....FFFFFF..FFFFFF..FFFFFFFFFFFFFF..........................................',
'................................EEEEEEEEEEEE..EEEEEEE.E......................................................FFFFFFF.FF.FFFFFF...FFFFF.FFFFFFFFFFFFFFF..........................................',
'...............................EEE...E..EEEEEEEE..EEEEEEEE..................................................FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF..........................................',
'................................EE......EE.EEE.E..EEEEEEEE..................................................FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF..........................................',
'...................................................EEEEEEE.................................................9FFFFFFFFFFF.............FFFFFF......................................................',
'....................................................EEEEEE9.................................................FFFFFFFFFF................FFFF......................................................',
'................................................................................................................................................................................................',
'................................................................................................................................................................................................'].join('');

var WIDTH = 192;

var __POPULATION__ = {
  'A': 48,
  'B': 40,
  'C': 40,
  'D': 60,
  'E': 48,
  'F': 60,
  'G': 32,
};

var __ISLANDS__ = {
  'A': ['Falafel Island', '#754100'],
  'B': ['Macaroni Island', '#d9a8e0'],
  'C': ['Soda Island', '#F1958F'],
  'D': ['Salad Island', '#00C230'],
  'E': ['Water Island', '#0056b3'],
  'F': ['Banana Island', '#fcdf03'],
  'G': ['Garlic Island', '#dfdfdf'],
};

var __INITIAL_WORDS__ = {
  'A': 'falafel',
  'B': 'macaroni',
  'C': 'soda',
  'D': 'salad',
  'E': 'water',
  'F': 'banana',
  'G': 'garlic',
};

var __AGENT_COLORS__ = {
  'A': ['#472700', '#301b00', '#b07e41'],
  'B': ['#dd42f5', '#c788d1', '#660175'],
  'C': ['#fc1703', '#fc0330', '#fc037f'],
  'D': ['#1b6b00', '#32fa00', '#17ff64'],
  'E': ['#03fcec', '#0394fc', '#031cfc'],
  'F': ['#fca503', '#f0b000', '#f09000'],
  'G': ['#c0c0c0', '#909090', '#606060'],
};

var __GATES__ = {
   '1': ['A', 'B'],
   '2': ['A', 'B'],
   '3': ['B', 'C'],
   '4': ['B', 'D'],
   '5': ['C', 'D'],
   '6': ['D', 'F'],
   '7': ['A', 'E'],
   '8': ['D', 'E'],
   '9': ['E', 'F'],
};

function mooreNeighborhood(index) {
  var row = Math.floor(index / WIDTH);
  var column = index % WIDTH;
  var map = __MAP__;
  var columnPerRow = WIDTH;
  return [
    map[ (row - 1) * columnPerRow + column - 1 ],  // NW
    map[ (row - 1) * columnPerRow + column ],      // N
    map[ (row - 1) * columnPerRow + column + 1 ],  // NE

    map[ row * columnPerRow + column - 1 ],  // W
    map[ row * columnPerRow + column + 1 ],  // E

    map[ (row + 1) * columnPerRow + column - 1 ],  // SW
    map[ (row + 1) * columnPerRow + column ],      // S
    map[ (row + 1) * columnPerRow + column + 1 ],  // SE
  ];
};

function isGate(x, y) {
  return __GATES__.hasOwnProperty(
    __MAP__[y * WIDTH + x]
  );
};

function cellToPosition(index) {
  return [
    index % WIDTH, 
    Math.floor(index / WIDTH)
  ];
};

function getIslandCells(indicator, excludeGates) {
  var map = Array.prototype.map;
  return map.call(__MAP__, function (node, index) {
    var isGate = (
      __GATES__.hasOwnProperty(node) &&
      mooreNeighborhood(index).filter(
        isEqual(indicator)
      ).length > 0
    );

    if (node === indicator || isGate) {
      return cellToPosition(index);
    }
  }).filter(
    Boolean
  );
};

function getIndicator(x, y) {
  return __MAP__[y * WIDTH + x];
}

function getGates(indicator) {
  var map = Array.prototype.map;
  return map.call(__MAP__, function (node, index) {
    if (node === indicator) {
      return cellToPosition(index);
    }
  }).filter(
    Boolean
  );
}

function findTargetGate(sourceIsland, position) {
  var indicator = getIndicator.apply(null, position);
  var map = Array.prototype.map;
  
  var indexes = map.call(__MAP__, function (node, index) {
    if (node === indicator) {
      return index
    }
  }).filter(
    Boolean
  ).filter(function (index) {
    return (
      mooreNeighborhood(index).indexOf(sourceIsland) === -1
    )
  });

  var targetCell = indexes[0];
  var targetIsland = mooreNeighborhood(
    targetCell
  ).filter(function (key) {
    return __ISLANDS__.hasOwnProperty(key);
  })[0];

  return {
    islandCode: targetIsland,
    position: cellToPosition(targetCell)
  };
}
